var Fe=Object.create;var W=Object.defineProperty;var je=Object.getOwnPropertyDescriptor;var ze=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty;var ne=l=>W(l,"__esModule",{value:!0});var He=(l,e)=>{for(var t in e)W(l,t,{get:e[t],enumerable:!0})},re=(l,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ze(e))!We.call(l,r)&&(t||r!=="default")&&W(l,r,{get:()=>e[r],enumerable:!(n=je(e,r))||n.enumerable});return l},m=(l,e)=>re(ne(W(l!=null?Fe(Oe(l)):{},"default",!e&&l&&l.__esModule?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l),Ne=(l=>(e,t)=>l&&l.get(e)||(t=re(ne({}),e,1),l&&l.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var Ge={};He(Ge,{BladeFormatter:()=>V,Formatter:()=>T});var ke=m(require("ignore")),O=m(require("path")),F=m(require("fs")),g=m(require("process")),$=m(require("chalk")),Ae=m(require("glob")),te=m(require("util")),_=m(require("lodash")),Te=m(require("find-config"));var Pe=m(require("os")),R=m(require("js-beautify")),i=m(require("lodash")),Me=m(require("vscode-textmate")),v=m(require("detect-indent")),be=m(require("aigle")),xe=m(require("xregexp")),Se=require("@shufo/tailwindcss-class-sorter");var we=require("fs"),ve=m(require("lodash")),Y=m(require("vscode-oniguruma")),$e=m(require("path"));var b=m(require("lodash")),he=m(require("fs")),J=m(require("chalk")),X=m(require("prettier/standalone")),U=m(require("@prettier/plugin-php/standalone")),Je=m(require("detect-indent"));var j=m(require("lodash")),G="@",P=["@alert","@pushonce","@push","@slot","@switch","@unless","@verbatim","@prependonce","@prepend","@once","@error","@empty","@guest","@isset","@permission","@permissions","@canany","@cannot","@can","@role","@hasrole","@hasanyrole","@hasallroles","@unlessrole","@hasexactroles","@if","@production","@env","@while","@auth","@forelse","@for","@foreach","@php","@component","@section","@customdirective"],ie=j.default.map(P,l=>l.substring(1)),C=["@endalert","@endpushonce","@endpush","@endslot","@endswitch","@endunless","@endverbatim","@show","@stop","@endprependonce","@endprepend","@endonce","@enderror","@append","@overwrite","@endempty","@endguest","@endisset","@endpermission","@endpermissions","@endcanany","@endcannot","@endcan","@endrole","@endhasrole","@endhasanyrole","@endhasallroles","@endunlessrole","@endhasexactroles","@endif","@endproduction","@endenv","@endwhile","@endauth","@endforelse","@endforeach","@endfor","@endphp","@endcomponent","@endsection","@endcustomdirective"],E=["@elseenv","@elseif","@elsecanany","@elsecannot","@elsecan","@else","@elsecustomdirective"],Z={"@section":2,"@push":2,"@prepend":2,"@slot":2},se=["@forelse","@if"],Q=["@empty"],ae=["@default"],k=["@forelse","@if","@for","@foreach","@while","@sectionmissing","@case"],H=["@endforelse","@endif","@endforeach","@endfor","@endwhile","@break"],A=["@set","@json","@selected","@checked","@disabled","@php","@include","@includeif","@includewhen","@includeunless","@includefirst","@button","@class","@props","@aware"],oe=["@if","@while","@case","@isset","@empty","@elseif","@component","@hassection","@unless"],N=["@hassection"],ce=["@charset","@color-profile","@counter-style","@font-face","@font-feature-values","@import","@keyframes","@media","@namespace","@page","@property","@supports"];function le(l,e){return j.default.filter(l.tokens,t=>{let n=e.substring(t.startIndex,t.endIndex).trim();return j.default.includes(P,n)||j.default.includes(C,n)}).length>=2}var w="\\(((?:[^)(]+|\\((?:[^)(]+|\\((?:[^)(]+|\\((?:[^)(]+|\\([^)(]*\\))*\\))*\\))*\\))*)\\)";var x=l=>{let e={get(){return null}};return b.default.isUndefined(l)||b.default.isNull(l)?e:l};async function K(l){return new Promise((e,t)=>{he.default.readFile(l,(n,r)=>n?t(n):e(r))})}function z(l){return l?l.split(/\r\n|\n|\r/):""}function D(l){return X.default.format(l.replace(/\n$/,""),{parser:"php",printWidth:1e3,singleQuote:!0,phpVersion:"8.0",plugins:[U.default]})}function I(l,e=1e3,t=!0){return X.default.format(`<?php echo ${l} ?>`,{parser:"php",printWidth:e,singleQuote:!0,phpVersion:"8.0",trailingCommaPHP:t,plugins:[U.default]}).replace(/<\?php echo (.*)?\?>/gs,(n,r)=>r.trim().replace(/;\s*$/,""))}function pe(l){let e=`<?php tmp_func${l}; ?>`,{ast:t}=X.default.__debug.parse(e,{parser:"php",phpVersion:"8.0",plugins:[U.default]});try{return t.children[0].expression.arguments.length||0}catch{return 0}}function de(l){return Promise.all(b.default.map(l,async e=>{process.stdout.write(`path: ${J.default.bold(e.path)}:${e.line}
`),process.stdout.write(J.default.red(`--${e.original}
`)),process.stdout.write(J.default.green(`++${e.formatted}
`))}))}function ue(l,e,t){let n=b.default.map(e,(r,s)=>b.default.isEmpty(r)||r===t[s]?null:{path:l,line:s+1,original:r,formatted:t[s]});return b.default.without(n,null)}async function Xe(l){let e=b.default.without(P,"@switch","@forelse","@php").join("|"),t=new RegExp(`(?!\\/\\*.*?\\*\\/)(${e})(\\s*?)${w}`,"gmi");return new Promise(n=>n(l)).then(n=>b.default.replace(n,t,(r,s,a,o)=>D(`<?php ${s.substr("1")}${a}(${o}) ?>`).replace(/<\?php\s(.*?)(\s*?)\((.*?)\);*\s\?>\n/gs,(c,h,u,p)=>`@${h.trim()}${u}(${p.trim()})`).replace(/([\n\s]*)->([\n\s]*)/gs,"->"))).then(n=>D(n))}async function ge(l){return Xe(l)}function me(l){let e=b.default.without(k,"@case"),t=b.default.without(H,"@break");return new Promise(n=>n(l)).then(n=>{let r=new RegExp(`(${e.join("|")})([\\s]*?)${w}`,"gis");return b.default.replace(n,r,(s,a,o,c)=>`<beautifyTag start="${a}${o}" exp="^^^${b.default.escape(c)}^^^">`)}).then(n=>{let r=new RegExp(`(?!end=".*)(${t.join("|")})(?!.*")`,"gi");return b.default.replace(n,r,(s,a)=>`</beautifyTag end="${a}">`)})}function ye(l){return new Promise(e=>e(l)).then(e=>b.default.replace(e,/<beautifyTag.*?start="(.*?)".*?exp=".*?\^\^\^(.*?)\^\^\^.*?"\s*>/gs,(t,n,r)=>`${n}(${b.default.unescape(r)})`)).then(e=>b.default.replace(e,/<\/beautifyTag.*?end="(.*?)"\s*>/gs,(t,n)=>`${n}`))}var Ue=["/\\*\\* phptag_start \\*\\*/","/\\*\\* end_phptag \\*\\*/","/\\*escaped\\*/","__BLADE__;","/\\* blade_comment_start \\*/","/\\* blade_comment_end \\*/","/\\*\\*\\*script_placeholder\\*\\*\\*/","beautifyTag","@customdirective","@elsecustomdirective","@endcustomdirective"];function fe(l){if(new RegExp(Ue.join("|")).test(l))throw new Error(["Can't format blade: something goes wrong.","Please check if template is too complicated or not. Or simplify template might solves issue."].join(`
`));return l}function q(l){return l.replace(/\$/g,"$$$$")}var ee=class{constructor(e,t){return(async()=>{var n;return this.vsctm=(n=e.default)!=null?n:e,this.oniguruma=t||Y.default||Y,await this.loadWasm(),this})()}async loadWasm(){var t;let e=await we.promises.readFile(require.resolve("vscode-oniguruma/release/onig.wasm"));if(await((t=this.oniguruma)==null?void 0:t.loadWASM(e.buffer)),!this.initCalled){try{this.oniguruma.loadWASM(e.buffer)}catch{this.initCalled=!0}this.initCalled=!0}}createRegistry(){return this.registry=new this.vsctm.Registry({loadGrammar:e=>e==="text.html.php.blade"?K($e.default.resolve(__dirname,"../syntaxes/blade.tmLanguage.json")).then(t=>this.vsctm.parseRawGrammar(t.toString(),"./blade.tmLanguage.json")):null,onigLib:Promise.resolve({createOnigScanner:e=>new this.oniguruma.OnigScanner(e),createOnigString:e=>new this.oniguruma.OnigString(e)})}),this.registry}tokenizeLines(e,t){return ve.default.map(e,n=>{var r;return t.tokenizeLine(n,(r=this.vsctm)==null?void 0:r.INITIAL)})}};var T=class{constructor(e){this.options=e,this.vsctm=x(this.options).vsctm||Me,this.oniguruma=x(this.options).oniguruma,this.indentCharacter=x(this.options).useTabs?"	":" ",this.indentSize=x(this.options).indentSize||4,this.wrapLineLength=x(this.options).wrapLineLength||120,this.wrapAttributes=x(this.options).wrapAttributes||"auto",this.currentIndentLevel=0,this.shouldBeIndent=!1,this.isInsideCommentBlock=!1,this.stack=[],this.ignoredLines=[],this.curlyBracesWithJSs=[],this.rawBlocks=[],this.rawPhpTags=[],this.inlineDirectives=[],this.conditions=[],this.inlinePhpDirectives=[],this.rawPropsBlocks=[],this.bladeDirectives=[],this.bladeComments=[],this.bladeBraces=[],this.rawBladeBraces=[],this.scripts=[],this.htmlAttributes=[],this.xData=[],this.xInit=[],this.htmlTags=[],this.templatingStrings=[],this.stringLiteralInPhp=[],this.shorthandBindings=[],this.componentAttributes=[],this.customDirectives=[],this.directivesInScript=[],this.unbalancedDirectives=[],this.escapedBladeDirectives=[],this.result=[],this.diffs=[]}formatContent(e){return new Promise(t=>t(e)).then(t=>this.preserveIgnoredLines(t)).then(t=>this.preserveCurlyBraceForJS(t)).then(t=>this.preserveRawPhpTags(t)).then(t=>this.preserveEscapedBladeDirective(t)).then(t=>ge(t)).then(t=>this.preserveBladeComment(t)).then(t=>this.preserveBladeBrace(t)).then(t=>this.preserveRawBladeBrace(t)).then(t=>this.preserveConditions(t)).then(t=>this.preserveInlineDirective(t)).then(t=>this.preserveInlinePhpDirective(t)).then(t=>this.preserveBladeDirectivesInScripts(t)).then(t=>this.preserveCustomDirective(t)).then(t=>this.preserveUnbalancedDirective(t)).then(t=>this.breakLineBeforeAndAfterDirective(t)).then(async t=>(this.bladeDirectives=await this.formatPreservedBladeDirectives(this.bladeDirectives),t)).then(t=>this.preserveScripts(t)).then(t=>this.sortTailwindcssClasses(t)).then(t=>this.formatXInit(t)).then(t=>this.formatXData(t)).then(t=>this.preserveComponentAttribute(t)).then(t=>this.preserveShorthandBinding(t)).then(t=>this.preserveHtmlAttributes(t)).then(t=>this.preserveHtmlTags(t)).then(t=>this.formatAsHtml(t)).then(t=>this.formatAsBlade(t)).then(t=>this.restoreHtmlTags(t)).then(t=>this.restoreHtmlAttributes(t)).then(t=>this.restoreShorthandBinding(t)).then(t=>this.restoreComponentAttribute(t)).then(t=>this.restoreXData(t)).then(t=>this.restoreXInit(t)).then(t=>this.restoreScripts(t)).then(t=>this.restoreUnbalancedDirective(t)).then(t=>this.restoreCustomDirective(t)).then(t=>this.restoreBladeDirectivesInScripts(t)).then(t=>this.restoreInlinePhpDirective(t)).then(t=>this.restoreInlineDirective(t)).then(t=>this.restoreConditions(t)).then(t=>this.restoreRawBladeBrace(t)).then(t=>this.restoreBladeBrace(t)).then(t=>this.restoreBladeComment(t)).then(t=>this.restoreEscapedBladeDirective(t)).then(t=>this.restoreRawPhpTags(t)).then(t=>this.restoreCurlyBraceForJS(t)).then(t=>this.restoreIgnoredLines(t)).then(t=>fe(t))}formatAsHtml(e){let t={indent_size:x(this.options).indentSize||4,wrap_line_length:x(this.options).wrapLineLength||120,wrap_attributes:x(this.options).wrapAttributes||"auto",end_with_newline:x(this.options).endWithNewline||!0,css:{end_with_newline:!1}},n=new Promise(r=>r(e)).then(r=>this.preservePhpBlock(r)).then(r=>me(r)).then(r=>R.default.html_beautify(r,t)).then(r=>ye(r)).then(r=>this.restorePhpBlock(r));return Promise.resolve(n)}async sortTailwindcssClasses(e){return this.options.sortTailwindcssClasses?i.default.replace(e,/(?<=\s+(?!:)class\s*=\s*([\"\']))(.*?)(?=\1)/gis,(t,n,r)=>i.default.isEmpty(r)?r:(0,Se.sortClasses)(r)):e}async preserveIgnoredLines(e){return i.default.chain(e).replace(/(^(?<!.+)^{{--\s*blade-formatter-disable\s*--}}.*?)([\r\n]*)$(?![\r\n])/gis,(t,n,r)=>this.storeIgnoredLines(`${n}${r.replace(/^\n/,"")}`)).replace(/(?:({{--\s*?blade-formatter-disable\s*?--}}|<!--\s*?prettier-ignore-start\s*?-->|{{--\s*?prettier-ignore-start\s*?--}})).*?(?:({{--\s*?blade-formatter-enable\s*?--}}|<!--\s*?prettier-ignore-end\s*?-->|{{--\s*?prettier-ignore-end\s*?--}}))/gis,t=>this.storeIgnoredLines(t)).replace(/(?:{{--\s*?blade-formatter-disable-next-line\s*?--}}|{{--\s*?prettier-ignore\s*?--}}|<!--\s*?prettier-ignore\s*?-->)[\r\n]+[^\r\n]+/gis,t=>this.storeIgnoredLines(t)).value()}async preserveCurlyBraceForJS(e){return i.default.replace(e,/@{{(.*?)}}/gs,(t,n)=>this.storeCurlyBraceForJS(n))}async preservePhpBlock(e){return this.preserveRawPhpBlock(e)}async preservePropsBlock(e){return i.default.replace(e,/@props\(((?:[^\\(\\)]|\([^\\(\\)]*\))*)\)/gs,(t,n)=>this.storeRawPropsBlock(n))}async preserveRawPhpBlock(e){return i.default.replace(e,/(?<!@)@php(.*?)@endphp/gs,(t,n)=>this.storeRawBlock(n))}async preserveHtmlTags(e){let t=["textarea","pre"];return i.default.replace(e,new RegExp(`<(${t.join("|")})\\s{0,1}.*?>.*?<\\/(${t.join("|")})>`,"gis"),n=>this.storeHtmlTag(n))}preserveCustomDirective(e){let t=[...i.default.without(P,"@unless"),...C,...E,"@unless\\(.*?\\)"].join("|"),n=[...i.default.without(P,"@unless"),...C,...E,...A,...k,"@unless[a-z]*\\(.*?\\)",...N,...ce].join("|"),r=new RegExp(`(?!(${n}))(@([a-zA-Z1-9_\\-]+))(?!.*?@end\\3)${w}.*?(?<!@end\\5)`,"gis"),s=new RegExp(`(?!(${t}))(@(unless)*([a-zA-Z1-9_\\-]+))(?!.*?\\2)(\\s|\\(.*?\\))+(.*?)(@end\\4)`,"gis"),a;return a=i.default.replace(e,r,o=>this.storeInlineCustomDirective(o)),a=i.default.replace(a,s,(o,c,h,u,p,d,y,S)=>{if(P.includes(h))return o;let f=o;return f=i.default.replace(f,new RegExp(`${h}(${w})*`,"gim"),B=>this.storeBeginCustomDirective(B)),f=i.default.replace(f,S,this.storeEndCustomDirective(S)),f=i.default.replace(f,new RegExp(`@else${p}(${w})*`,"gim"),B=>this.storeElseCustomDirective(B)),f}),s.test(a)&&(a=this.preserveCustomDirective(a)),a}preserveInlineDirective(e){let t=new RegExp(`(?<=<[\\w\\-\\_]+?[^>]*?)${G}(${ie.join("|")})(\\s*?)(\\(.*?\\))(.*?)(@end\\1|@endif)(?=.*?/*>)`,"gims"),n=i.default.replace(e,t,(r,s,a,o,c,h)=>`${this.storeInlineDirective(`${G}${s.trim()}${a}${o.trim()} ${c.trim()} ${h.trim()}`)}`);return t.test(n)?this.preserveInlineDirective(n):n}async preserveInlinePhpDirective(e){return i.default.replace(e,new RegExp(`(?!\\/\\*.*?\\*\\/)(${A.join("|")})(\\s*?)${w}`,"gmsi"),t=>this.storeInlinePhpDirective(t))}preserveBladeDirectivesInScripts(e){return i.default.replace(e,/(?<=<script[^>]*?(?<!=)>)(.*?)(?=<\/script>)/gis,t=>{let n=[...P,...A];if(new RegExp(n.join("|"),"gmi").test(t)===!1)return t.trim();let r=A.join("|"),s=new RegExp(`(?!\\/\\*.*?\\*\\/)(${r})(\\s*?)${w}`,"gmi"),a=i.default.chain(C).without("@endphp"),o=t;return o=i.default.replace(o,s,c=>this.storeBladeDirective(I(c))),o=i.default.replace(o,new RegExp(`(${P.join("|")})\\s*?${w}`,"gis"),c=>`if ( /*${this.storeBladeDirectiveInScript(c)}*/ ) {`),o=i.default.replace(o,new RegExp(`(${[...E,...Q].join("|")})(?!\\w+?\\s*?\\(.*?\\))`,"gis"),c=>`/***script_placeholder***/} /* ${this.storeBladeDirectiveInScript(c)} */ {`),o=i.default.replace(o,new RegExp(`(${a.join("|")})`,"gis"),c=>`/***script_placeholder***/} /*${this.storeBladeDirectiveInScript(c)}*/`),o=i.default.replace(o,/(?<!@)@php(.*?)@endphp/gis,(c,h)=>this.storeRawBlock(h)),o=this.preserveCustomDirectiveInScript(o),o})}preserveCustomDirectiveInScript(e){let t=[...i.default.without(P,"@unless"),...C,...E,"@unless\\(.*?\\)"].join("|"),n=[...i.default.without(P,"@unless"),...C,...E,...A,...k,"@unless[a-z]*\\(.*?\\)",...N].join("|"),r=new RegExp(`(?!(${n}))(@([a-zA-Z1-9_\\-]+))(?!.*?@end\\3)${w}.*?(?<!@end\\5)`,"gis"),s=new RegExp(`(?!(${t}))(@(unless)*([a-zA-Z1-9_\\-]+))(?!.*?\\2)(\\s|\\(.*?\\))+(.*?)(@end\\4)`,"gis"),a;return a=i.default.replace(e,r,o=>this.storeInlineCustomDirective(o)),a=i.default.replace(a,s,(o,c,h,u,p,d,y,S)=>{if(P.includes(h))return o;let f=o;return f=i.default.replace(f,new RegExp(`${h}(${w})*`,"gim"),B=>`if ( /*${this.storeBladeDirectiveInScript(B)}*/ ) {`),f=i.default.replace(f,new RegExp(`@else${p}(${w})*`,"gim"),B=>`/***script_placeholder***/} /* ${this.storeBladeDirectiveInScript(B)} */ {`),f=i.default.replace(f,S,B=>`/***script_placeholder***/} /*${this.storeBladeDirectiveInScript(B)}*/`),f}),s.test(a)&&(a=this.preserveCustomDirectiveInScript(a)),a}breakLineBeforeAndAfterDirective(e){e=i.default.replace(e,new RegExp(`(?<=<.*?(?<!=)>)(${i.default.without(P,"@php").join("|")})(\\s*)${w}.*?(?=<.*?>)`,"gmis"),s=>`
${s.trim()}
`),e=i.default.replace(e,new RegExp(`(?<=<.*?(?<!=)>).*?(${i.default.without(C,"@endphp").join("|")})(?=<.*?>)`,"gmis"),s=>`
${s.trim()}
`);let t=["@case",...E];e=i.default.replace(e,new RegExp(`(\\s*?)(${t.join("|")})(\\s*?)${w}(\\s*)`,"gmi"),s=>`
${s.trim()}
`),e=i.default.replace(e,new RegExp(`\\s*?(?!(${i.default.without(E,"@else").join("|")}))@else\\s+`,"gim"),s=>`
${s.trim()}
`),e=i.default.replace(e,/@case\S*?\s*?@case/gim,s=>`${s.replace(`
`,"")}`);let n=["@break"];i.default.forEach(n,s=>{e=i.default.replace(e,new RegExp(`(\\s*?)${s}\\s+`,"gmi"),a=>`
${a.trim()}

`)}),i.default.forEach(["@default"],s=>{e=i.default.replace(e,new RegExp(`(\\s*?)${s}\\s*`,"gmi"),a=>`

${a.trim()}
`)});let r=i.default.chain(P).map(s=>i.default.replace(s,/@/,"")).value();return i.default.forEach(r,s=>{try{let a=xe.default.matchRecursive(e,`\\@${s}`,`\\@end${s}`,"gmi",{valueNames:[null,"left","match","right"]});if(i.default.isEmpty(a))return;for(let o of a)if(o.name==="match"){new RegExp(P.join("|")).test(o.value)&&(e=i.default.replace(e,o.value,this.breakLineBeforeAndAfterDirective(q(o.value))));let c=new RegExp(`^(\\s*?)${w}(.*)`,"gmis"),h=i.default.replace(`${o.value}`,c,(u,p,d,y)=>y.trim()===""?`${p}(${d.trim()})
${y.trim()}`:`${p}(${d.trim()})
${y.trim()}
`);e=i.default.replace(e,o.value,q(h))}}catch{}}),e}async preserveEscapedBladeDirective(e){return i.default.replace(e,/@@\w*/gim,t=>this.storeEscapedBladeDirective(t))}async preserveBladeComment(e){return i.default.replace(e,/\{\{--(.*?)--\}\}/gs,(t,n)=>this.storeBladeComment(n))}async preserveBladeBrace(e){return i.default.replace(e,/\{\{(.*?)\}\}/gs,(t,n)=>this.storeBladeBrace(n,n.length))}async preserveRawBladeBrace(e){return i.default.replace(e,/\{!!(.*?)!!\}/gs,(t,n)=>this.storeRawBladeBrace(n))}async preserveConditions(e){let t=new RegExp(`(${oe.join("|")})(\\s*?)${w}`,"gi");return i.default.replace(e,t,(n,r,s,a)=>`${r}${s}(${this.storeConditions(a)})`)}preserveUnbalancedDirective(e){let t=new RegExp(`((${N.join("|")})(?!.*?\\2)(?:\\s|\\(.*?\\)))+(?=.*?@endif)`,"gis"),n=i.default.replace(e,t,(r,s)=>`${this.storeUnbalancedDirective(s)}`);return t.test(n)&&(n=this.preserveUnbalancedDirective(n)),n}async preserveRawPhpTags(e){return i.default.replace(e,/<\?php(.*?)\?>/gms,t=>this.storeRawPhpTags(t))}async preserveScripts(e){return i.default.replace(e,/<script.*?>.*?<\/script>/gis,t=>this.storeScripts(t))}async preserveHtmlAttributes(e){return i.default.replace(e,/(?<=<[\w]*?[\s].*?)[\w\-\_\:]+?=(["']).*?(?<!\\)\1(?=.*?(?<!=)>)/gms,t=>`${this.storeHtmlAttribute(t)}`)}async preserveShorthandBinding(e){return i.default.replace(e,/(?<=<(?!livewire:)[^<]*?(\s|x-bind)):{1}(?<!=>)[\w\-_.]*?=(["'])(?!=>)[^]*?\2(?=[^>]*?\/*?>)/gim,t=>`${this.storeShorthandBinding(t)}`)}async preserveComponentAttribute(e){return i.default.replace(e,/(?<=<(x-|livewire:)[^<]*?\s):{1,2}(?<!=>)[\w\-_.]*?=(["'])(?!=>)[^]*?\2(?=[^>]*?\/*?>)/gim,t=>`${this.storeComponentAttribute(t)}`)}async formatXData(e){return i.default.replace(e,/(\s*)x-data="(.*?)"(\s*)/gs,(t,n,r,s)=>`${n}x-data="${this.storeXData(r)}"${s}`)}async formatXInit(e){return i.default.replace(e,/(\s*)x-init="(.*?)"(\s*)/gs,(t,n,r,s)=>`${n}x-init="${this.storeXInit(r)}"${s}`)}preserveStringLiteralInPhp(e){return i.default.replace(e,/['"].*?['"]/gms,t=>`${this.storeStringLiteralInPhp(t)}`)}storeIgnoredLines(e){return this.getIgnoredLinePlaceholder(this.ignoredLines.push(e)-1)}storeCurlyBraceForJS(e){return this.getCurlyBraceForJSPlaceholder(this.curlyBracesWithJSs.push(e)-1)}storeRawBlock(e){return this.getRawPlaceholder(this.rawBlocks.push(e)-1)}storeInlineDirective(e){return this.getInlinePlaceholder(this.inlineDirectives.push(e)-1,e.length)}storeConditions(e){return this.getConditionPlaceholder(this.conditions.push(e)-1)}storeInlinePhpDirective(e){return this.getInlinePhpPlaceholder(this.inlinePhpDirectives.push(e)-1)}storeRawPropsBlock(e){return this.getRawPropsPlaceholder(this.rawPropsBlocks.push(e)-1)}storeBladeDirective(e){return this.getBladeDirectivePlaceholder(this.bladeDirectives.push(e)-1)}storeEscapedBladeDirective(e){return this.getEscapedBladeDirectivePlaceholder((this.escapedBladeDirectives.push(e)-1).toString())}storeBladeComment(e){return this.getBladeCommentPlaceholder(this.bladeComments.push(e)-1)}storeHtmlTag(e){return this.getHtmlTagPlaceholder((this.htmlTags.push(e)-1).toString())}storeInlineCustomDirective(e){return this.getInlineCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeBeginCustomDirective(e){return this.getBeginCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeElseCustomDirective(e){return this.getElseCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeEndCustomDirective(e){return this.getEndCustomDirectivePlaceholder((this.customDirectives.push(e)-1).toString())}storeUnbalancedDirective(e){return this.getUnbalancedDirectivePlaceholder((this.unbalancedDirectives.push(e)-1).toString())}storeBladeBrace(e,t){let n=this.bladeBraces.push(e)-1,r="{{  }}";return this.getBladeBracePlaceholder(n,t+r.length)}storeRawBladeBrace(e){let t=this.rawBladeBraces.push(e)-1;return this.getRawBladeBracePlaceholder(t)}storeRawPhpTags(e){let t=this.rawPhpTags.push(e)-1;return this.getRawPhpTagPlaceholder(t)}storeScripts(e){let t=this.scripts.push(e)-1;return this.getScriptPlaceholder(t)}storeHtmlAttribute(e){let t=this.htmlAttributes.push(e)-1;return e.length>0?this.getHtmlAttributePlaceholder(t.toString(),e.length):this.getHtmlAttributePlaceholder(t.toString(),0)}storeShorthandBinding(e){let t=this.shorthandBindings.push(e)-1;return this.getShorthandBindingPlaceholder(t.toString(),e.length)}storeComponentAttribute(e){let t=this.componentAttributes.push(e)-1;return this.getComponentAttributePlaceholder(t.toString())}storeXData(e){let t=this.xData.push(e)-1;return this.getXDataPlaceholder(t)}storeXInit(e){let t=this.xInit.push(e)-1;return this.getXInitPlaceholder(t)}storeTemplatingString(e){let t=this.templatingStrings.push(e)-1;return this.getTemplatingStringPlaceholder(t)}storeStringLiteralInPhp(e){let t=this.stringLiteralInPhp.push(e)-1;return this.getStringLiteralInPhpPlaceholder(t)}storeBladeDirectiveInScript(e){return this.getBladeDirectiveInScriptPlaceholder((this.directivesInScript.push(e)-1).toString())}getIgnoredLinePlaceholder(e){return i.default.replace("___ignored_line_#___","#",e)}getCurlyBraceForJSPlaceholder(e){return i.default.replace("___js_curly_brace_#___","#",e)}getRawPlaceholder(e){return i.default.replace("___raw_block_#___","#",e)}getInlinePlaceholder(e,t=0){if(t>0){let r=t-"___inline_directive_#___".length;return i.default.replace(`___inline_directive_${i.default.repeat("_",r>0?r:0)}#___`,"#",e)}return i.default.replace("___inline_directive_+?#___","#",e)}getConditionPlaceholder(e){return i.default.replace("___directive_condition_#___","#",e)}getInlinePhpPlaceholder(e){return i.default.replace("___inline_php_directive_#___","#",e)}getRawPropsPlaceholder(e){return i.default.replace("@__raw_props_block_#__@","#",e)}getBladeDirectivePlaceholder(e){return i.default.replace("___blade_directive_#___","#",e)}getEscapedBladeDirectivePlaceholder(e){return i.default.replace("___escaped_directive_#___","#",e)}getBladeCommentPlaceholder(e){return i.default.replace("___blade_comment_#___","#",e)}getBladeBracePlaceholder(e,t=0){if(t>0){let r=t-"___blade_brace_#___".length;return i.default.replace(`___blade_brace_${i.default.repeat("_",r>0?r:0)}#___`,"#",e)}return i.default.replace("___blade_brace_+?#___","#",e)}getRawBladeBracePlaceholder(e){return i.default.replace("___raw_blade_brace_#___","#",e)}getRawPhpTagPlaceholder(e){return i.default.replace("___raw_php_tag_#___","#",e)}getScriptPlaceholder(e){return i.default.replace("<blade ___scripts_#___ />","#",e)}getHtmlTagPlaceholder(e){return i.default.replace("<blade ___html_tags_#___ />","#",e)}getInlineCustomDirectivePlaceholder(e){return i.default.replace("___inline_cd_#___","#",e)}getBeginCustomDirectivePlaceholder(e){return i.default.replace("@customdirective(___#___)","#",e)}getElseCustomDirectivePlaceholder(e){return i.default.replace("@else(___#___)","#",e)}getEndCustomDirectivePlaceholder(e){return i.default.replace("@endcustomdirective(___#___)","#",e)}getUnbalancedDirectivePlaceholder(e){return i.default.replace("@if (unbalanced___#___)","#",e)}getHtmlAttributePlaceholder(e,t){if(t&&t>0){let r=t-"___attrs_#___".length;return i.default.replace(`___attrs${i.default.repeat("_",r>0?r:1)}#___`,"#",e)}return i.default.isNull(t)?i.default.replace("___attrs_#___","#",e):i.default.replace("___attrs_+?#___","#",e)}getShorthandBindingPlaceholder(e,t=0){if(t&&t>0){let r=t-"___short_binding_#___".length;return i.default.replace(`___short_binding_${i.default.repeat("_",r>0?r:1)}#___`,"#",e)}return i.default.replace("___short_binding_+?#___","#",e)}getComponentAttributePlaceholder(e){return i.default.replace("___attribute_#___","#",e)}getXInitPlaceholder(e){return i.default.replace("___x_init_#___","#",e)}getPlaceholder(e,t,n=null){if(n&&n>0){let r=`___${e}_#___`,s=n-r.length;return i.default.replace(`___${e}${i.default.repeat("_",s>0?s:1)}#___`,"#",t)}return i.default.isNull(n)?i.default.replace(`___${e}_#___`,"#",t):i.default.replace(`s___${e}_+?#___`,"#",t)}getXDataPlaceholder(e){return i.default.replace("___x_data_#___","#",e)}getTemplatingStringPlaceholder(e){return i.default.replace("___templating_str_#___","#",e)}getStringLiteralInPhpPlaceholder(e){return i.default.replace("'___php_content_#___'","#",e)}getBladeDirectiveInScriptPlaceholder(e){return i.default.replace("___directives_script_#___","#",e)}restoreIgnoredLines(e){return i.default.replace(e,new RegExp(`${this.getIgnoredLinePlaceholder("(\\d+)")}`,"gm"),(t,n)=>this.ignoredLines[n])}restoreCurlyBraceForJS(e){return i.default.replace(e,new RegExp(`${this.getCurlyBraceForJSPlaceholder("(\\d+)")}`,"gm"),(t,n)=>`@{{ ${R.default.js_beautify(this.curlyBracesWithJSs[n].trim())} }}`)}restorePhpBlock(e){return this.restoreRawPhpBlock(e).then(t=>this.restoreRawPropsBlock(t))}async restoreRawPhpBlock(e){return i.default.replace(e,new RegExp(`${this.getRawPlaceholder("(\\d+)")}`,"gm"),(t,n)=>{var c;let r=this.rawBlocks[n],s=this.getRawPlaceholder(n.toString()),a=(c=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?c:[""],o=(0,v.default)(a[0]);return this.isInline(r)&&this.isMultilineStatement(r)?r=D(`<?php
${r}
?>`).trim():r.split(`
`).length>1?r=D(`<?php${r}?>`).trimRight(`
`):r=`<?php${r}?>`,i.default.replace(r,/^(\s*)?<\?php(.*?)\?>/gms,(h,u,p)=>{if(this.isInline(r))return`@php${p}@endphp`;let d=this.preserveStringLiteralInPhp(p),y=this.indentRawBlock(o,d);return`@php${this.restoreStringLiteralInPhp(y)}@endphp`})})}async restoreRawPropsBlock(e){let t=this.getRawPropsPlaceholder("(\\d+)");return i.default.replace(e,new RegExp(t,"gms"),(n,r)=>`@props(${I(this.rawPropsBlocks[r]).trimRight()})`)}isInline(e){return i.default.split(e,`
`).length===1}isMultilineStatement(e){return D(`<?php${e}?>`).trimRight().split(`
`).length>1}indentRawBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${e.indent}${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:(r+1)*this.indentSize),a=this.indentCharacter.repeat(r<0?0:r*this.indentSize),o=t.split(`
`);return i.default.chain(o).map((c,h)=>h===0?c.trim():h===o.length-1?a+c:s+c).join(`
`)}indentBladeDirectiveBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${e.indent}${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=this.indentCharacter.repeat(r<0?0:r*this.indentSize),o=t.split(`
`);return i.default.chain(o).map((c,h)=>h===o.length-1?a+c:s+c).value().join(`
`)}indentScriptBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=this.indentCharacter.repeat(r<0?0:r*this.indentSize),c=i.default.replace(t,/`.*?`/gs,u=>this.storeTemplatingString(u)).split(`
`),h=i.default.chain(c).map((u,p)=>p===0?u:p===c.length-1?a+u:i.default.isEmpty(u)?u:s+u).value().join(`
`);return this.restoreTemplatingString(`${h}`)}indentRawPhpBlock(e,t){if(i.default.isEmpty(e.indent))return t;if(this.isInline(t))return`${t}`;let r=e.amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=t.split(`
`);return i.default.chain(a).map((o,c)=>c===0?o.trim():s+o).value().join(`
`)}indentComponentAttribute(e,t){if(i.default.isEmpty(e))return t;if(this.isInline(t))return`${t}`;if(this.isInline(t)&&/\S/.test(e))return`${t}`;let r=(0,v.default)(e).amount/this.indentSize,s=this.indentCharacter.repeat(r<0?0:r*this.indentSize),a=t.split(`
`);return i.default.chain(a).map((o,c)=>c===0?o.trim():s+o).value().join(`
`)}restoreBladeDirectivesInScripts(e){let t=new RegExp(`${this.getBladeDirectivePlaceholder("(\\d+)")}`,"gm"),n=i.default.replace(e,t,(r,s)=>{var h;let a=this.getBladeDirectivePlaceholder(s.toString()),o=(h=e.match(new RegExp(`^(.*?)${a}`,"gmi")))!=null?h:[""],c=(0,v.default)(o[0]);return this.indentBladeDirectiveBlock(c,this.bladeDirectives[s])});return n=i.default.replace(n,/(?<=<script[^>]*?(?<!=)>)(.*?)(?=<\/script>)/gis,r=>{let s=r;return s=i.default.replace(s,new RegExp(`if \\( \\/\\*(?:(?:${this.getBladeDirectiveInScriptPlaceholder("(\\d+)")}).*?)\\*\\/ \\) \\{`,"gis"),(a,o)=>`${this.directivesInScript[o]}`),s=i.default.replace(s,new RegExp(`} \\/\\* (?:${this.getBladeDirectiveInScriptPlaceholder("(\\d+)")}) \\*\\/ {`,"gis"),(a,o)=>`${this.directivesInScript[o].trim()}`),s=i.default.replace(s,new RegExp(`} \\/\\*(?:${this.getBladeDirectiveInScriptPlaceholder("(\\d+)")})\\*\\/`,"gis"),(a,o)=>`${this.directivesInScript[o]}`),s=i.default.replace(s,new RegExp(`${this.getRawPlaceholder("(\\d+)")}`,"gm"),(a,o)=>{var d;let c=this.rawBlocks[o],h=this.getRawPlaceholder(o.toString()),u=(d=e.match(new RegExp(`^(.*?)${h}`,"gmi")))!=null?d:[""],p=(0,v.default)(u[0]);return this.isInline(c)&&this.isMultilineStatement(c)?c=D(`<?php
${c}
?>`).trim():c.split(`
`).length>1?c=D(`<?php${c}?>`).trim():c=`<?php${c}?>`,i.default.replace(c,/^(\s*)?<\?php(.*?)\?>/gms,(y,S,f)=>{if(this.isInline(c))return`@php${f}@endphp`;let B=this.preserveStringLiteralInPhp(f),L=this.indentRawBlock(p,B);return`@php${this.restoreStringLiteralInPhp(L)}@endphp`})}),s=i.default.replace(s,/(?<=[\S]+)\s*?\/\*\*\*script_placeholder\*\*\*\/(\s)/gim,(a,o)=>o),s}),t.test(n)&&(n=this.restoreBladeDirectivesInScripts(n)),n}async formatPreservedBladeDirectives(e){return be.default.map(e,async t=>{let n=await this.formatAsHtml(t);return(await this.formatAsBlade(n)).trimRight(`
`)})}restoreBladeComment(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getBladeCommentPlaceholder("(\\d+)")}`,"gms"),(n,r)=>`{{-- ${this.bladeComments[r].trim()} --}}`))}async restoreEscapedBladeDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getEscapedBladeDirectivePlaceholder("(\\d+)")}`,"gms"),(n,r)=>this.escapedBladeDirectives[r]))}restoreBladeBrace(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getBladeBracePlaceholder("(\\d+)")}`,"gm"),(n,r)=>{var h;let s=this.getBladeBracePlaceholder(r.toString()),a=(h=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?h:[""],o=(0,v.default)(a[0]),c=this.bladeBraces[r];return c.trim()===""?`{{${c}}}`:this.isInline(c)?`{{ ${I(c,1e3,!1).replace(/([\n\s]*)->([\n\s]*)/gs,"->").split(`
`).map(u=>u.trim()).join("").trimRight(`
`)} }}`:`{{ ${this.indentRawPhpBlock(o,I(c,this.wrapLineLength,!0).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`))} }}`}))}restoreRawBladeBrace(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getRawBladeBracePlaceholder("(\\d+)")}`,"gms"),(n,r)=>{let s=this.rawBladeBraces[r];return s.trim()===""?`{!!${s}!!}`:`{!! ${I(s).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`)} !!}`}))}restoreInlineDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getInlinePlaceholder("(\\d+)")}`,"gms"),(n,r)=>this.inlineDirectives[r]))}restoreConditions(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getConditionPlaceholder("(\\d+)")}`,"gms"),(n,r)=>{var h;let s=this.getConditionPlaceholder(r),a=(h=e.match(new RegExp(`^(.*?)${s}`,"gmi")))!=null?h:[""],o=(0,v.default)(a[0]),c=this.conditions[r];return this.indentComponentAttribute(o.indent,I(c).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trimEnd())}))}restoreUnbalancedDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,/@if \(unbalanced___(\d+)___\)/gms,(n,r)=>this.unbalancedDirectives[r]))}restoreInlinePhpDirective(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getInlinePhpPlaceholder("(\\d+)")}`,"gm"),(n,r)=>{var h;let s=this.inlinePhpDirectives[r],a=this.getInlinePhpPlaceholder(r),o=(h=e.match(new RegExp(`^(.*?)${a}`,"gmi")))!=null?h:[""],c=(0,v.default)(o[0]);return s.includes("@php")?`${I(s).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().trimRight(`
`)}`:/(@button|@class|@include|@disabled|@checked)/gi.test(s)?i.default.replace(s,/(?<=@(button|class|include|disabled|checked).*?\()(.*)(?=\))/gis,(p,d,y)=>{let S=this.wrapLineLength;["button","class"].includes(d)&&(S=80),d==="include"&&(S=this.wrapLineLength-"func".length-r.length-c.amount);let f=I(`func(${y})`,S,!0).replace(/([\n\s]*)->([\n\s]*)/gs,"->").replace(/,(\s*?\))/gis,(B,L)=>L).trim();return this.isInline(f)?`${this.indentRawPhpBlock(c,`${f}`).replace(/func\((.*)\)/gis,(B,L)=>L).trim()}`:this.indentRawPhpBlock(c,`${f}`).replace(/func\((.*)\)/gis,(B,L)=>L).trim()}):`${I(s).trimEnd()}`}))}restoreRawPhpTags(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getRawPhpTagPlaceholder("(\\d+)")}`,"gms"),(n,r)=>{var s;try{let a=this.rawPhpTags[r],c=/(?<=<\?php\s*?)\/\*.*?\*\/(?=\s*?\?>)/gim.test(a)&&this.isInline(a),h=this.getRawPhpTagPlaceholder(r),u=(s=e.match(new RegExp(`^(.*?)${h}`,"gmi")))!=null?s:[""],p=(0,v.default)(u[0]);if(c)return a;let d=D(this.rawPhpTags[r]).trim().trimRight(`
`);return this.isInline(d)?d:p.indent?this.indentRawPhpBlock(p,d):d}catch{return`${this.rawPhpTags[r]}`}}))}restoreScripts(e){return new Promise(t=>t(e)).then(t=>i.default.replace(t,new RegExp(`${this.getScriptPlaceholder("(\\d+)")}`,"gim"),(n,r)=>{var u;let s=this.scripts[r],a=this.getScriptPlaceholder(r),o=(u=e.match(new RegExp(`^(.*?)${a}`,"gmi")))!=null?u:[""],c=(0,v.default)(o[0]),h={indent_size:x(this.options).indentSize||4,wrap_line_length:x(this.options).wrapLineLength||120,wrap_attributes:x(this.options).wrapAttributes||"auto",end_with_newline:!1,templating:["php"]};return this.indentScriptBlock(c,R.default.html_beautify(s,h))}))}async restoreCustomDirective(e){return this.restoreInlineCustomDirective(e).then(t=>this.restoreBeginCustomDirective(t)).then(t=>this.restoreElseCustomDirective(t)).then(t=>this.restoreEndCustomDirective(t))}async restoreInlineCustomDirective(e){return i.default.replace(e,new RegExp(`${this.getInlineCustomDirectivePlaceholder("(\\d+)")}`,"gim"),(t,n)=>{var c;let r=this.getInlineCustomDirectivePlaceholder(n.toString()),s=(c=e.match(new RegExp(`^(.*?)${i.default.escapeRegExp(r)}`,"gmi")))!=null?c:[""],a=(0,v.default)(s[0]),o=`${this.customDirectives[n]}`;return i.default.replace(o,/(@[a-zA-z0-9\-_]+)(.*)/gis,(h,u,p)=>{try{let d=I(`func${p}`).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().substring(4);return`${u}${this.indentComponentAttribute(a.indent,d)}`}catch{return`${h}`}})})}async restoreBeginCustomDirective(e){return i.default.replace(e,new RegExp(`@customdirective\\(___(\\d+)___\\)\\s*?(${w})*`,"gim"),(t,n)=>{var c;let r=this.getBeginCustomDirectivePlaceholder(n.toString()),s=(c=e.match(new RegExp(`^(.*?)${i.default.escapeRegExp(r)}`,"gmi")))!=null?c:[""],a=(0,v.default)(s[0]),o=`${this.customDirectives[n]}`;return i.default.replace(o,/(@[a-zA-z0-9\-_]+)(.*)/gis,(h,u,p)=>{try{let d=I(`func${p}`,this.wrapLineLength,!1).replace(/([\n\s]*)->([\n\s]*)/gs,"->").trim().substring(4);return`${u}${this.indentComponentAttribute(a.indent,d)}`}catch{return`${h}`}})})}async restoreElseCustomDirective(e){return i.default.replace(e,/@else\(___(\d+)___\)/gim,(t,n)=>`${this.customDirectives[n]}`)}async restoreEndCustomDirective(e){return i.default.replace(e,/@endcustomdirective\(___(\d+)___\)/gim,(t,n)=>`${this.customDirectives[n]}`)}async restoreHtmlTags(e){return i.default.replace(e,new RegExp(`${this.getHtmlTagPlaceholder("(\\d+)")}`,"gim"),(t,n)=>{var p;let r=this.getHtmlTagPlaceholder(n.toString()),s=(p=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?p:[""],a=(0,v.default)(s[0]),o={indent_size:x(this.options).indentSize||4,wrap_line_length:x(this.options).wrapLineLength||120,wrap_attributes:x(this.options).wrapAttributes||"auto",end_with_newline:!1,templating:["php"]},c=this.htmlTags[n],h=i.default.first(c.match(/(<(textarea|pre).*?(?<!=)>)(?=.*?<\/\2>)/gis));if(h===void 0)return`${this.indentScriptBlock(a,R.default.html_beautify(c,o))}`;let u=c.substring(h.length,c.length);return`${this.indentScriptBlock(a,R.default.html_beautify(h,o))}${u}`})}restoreHtmlAttributes(e){return i.default.replace(e,new RegExp(`${this.getHtmlAttributePlaceholder("(\\d+)")}`,"gms"),(t,n)=>this.htmlAttributes[n])}restoreXData(e){return i.default.replace(e,new RegExp(`${this.getXDataPlaceholder("(\\d+)")}`,"gm"),(t,n)=>{var d;let r=this.getXDataPlaceholder(n.toString()),s=(d=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?d:[""],a=(0,v.default)(s[0]),o=this.formatJS(this.xData[n]).split(`
`),c=a.amount/(this.indentCharacter==="	"?4:1),h=o[0],u=this.indentCharacter.repeat(c<0?0:c),p=o.map(y=>u+y);return p[0]=h,`${p.join(`
`)}`})}restoreXInit(e){return i.default.replace(e,new RegExp(`${this.getXInitPlaceholder("(\\d+)")}`,"gm"),(t,n)=>{var d;let r=this.getXInitPlaceholder(n.toString()),s=(d=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?d:[""],a=(0,v.default)(s[0]),o=this.formatJS(this.xInit[n]).split(`
`),c=a.amount/(this.indentCharacter==="	"?4:1),h=o[0],u=this.indentCharacter.repeat(c<0?0:c),p=o.map(y=>u+y);return p[0]=h,`${p.join(`
`)}`})}restoreTemplatingString(e){return i.default.replace(e,new RegExp(`${this.getTemplatingStringPlaceholder("(\\d+)")}`,"gms"),(t,n)=>this.templatingStrings[n])}restoreStringLiteralInPhp(e){return i.default.replace(e,new RegExp(`${this.getStringLiteralInPhpPlaceholder("(\\d+)")}`,"gms"),(t,n)=>this.stringLiteralInPhp[n])}restoreComponentAttribute(e){return i.default.replace(e,new RegExp(`${this.getComponentAttributePlaceholder("(\\d+)")}`,"gim"),(t,n)=>{var h;let r=this.getComponentAttributePlaceholder(n),s=(h=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?h:[""],a=(0,v.default)(s[0]),o=this.componentAttributes[n],c=i.default.replace(o,/(:{1,2}.*?=)(["'])(.*?)(?=\2)/gis,(u,p,d,y)=>{if(y==="")return u;if(p.startsWith("::"))return`${p}${d}${R.default.js_beautify(y,{wrap_line_length:this.wrapLineLength-a.amount,brace_style:"preserve-inline"}).trim()}`;if(this.isInline(y))try{return`${p}${d}${I(y,this.wrapLineLength-a.amount).trimEnd()}`}catch{return`${p}${d}${y}`}return`${p}${d}${I(y,this.wrapLineLength-a.amount).trimEnd()}`});return`${this.indentComponentAttribute(a.indent,c)}`})}restoreShorthandBinding(e){return i.default.replace(e,new RegExp(`${this.getShorthandBindingPlaceholder("(\\d+)")}`,"gms"),(t,n)=>{var h;let r=this.getShorthandBindingPlaceholder(n),s=(h=e.match(new RegExp(`^(.*?)${r}`,"gmi")))!=null?h:[""],a=(0,v.default)(s[0]),o=this.shorthandBindings[n],c=i.default.replace(o,/(:{1,2}.*?=)(["'])(.*?)(?=\2)/gis,(u,p,d,y)=>{let S={wrap_line_length:this.wrapLineLength-a.amount,brace_style:"preserve-inline"};if(y==="")return u;if(this.isInline(y))try{return`${p}${d}${R.default.js_beautify(y,S).trimEnd()}`}catch{return`${p}${d}${y}`}return`${p}${d}${R.default.js_beautify(y,S).trimEnd()}`});return`${this.indentComponentAttribute(a.indent,c)}`})}async formatAsBlade(e){this.currentIndentLevel=0,this.shouldBeIndent=!1;let t=z(e),n=await new ee(this.vsctm,this.oniguruma);return n.createRegistry(e).loadGrammar("text.html.php.blade").then(a=>n.tokenizeLines(t,a)).then(a=>this.formatTokenizedLines(t,a)).catch(a=>{throw a})}formatTokenizedLines(e,t){this.result=[],this.stack=[];for(let n=0;n<e.length;n+=1){let r=e[n],s=t[n];this.processLine(s,r)}return this.result.join(Pe.default.EOL)}processLine(e,t){this.processTokenizeResult(e,t)}processKeyword(e){if(i.default.includes(k,e)){i.default.last(this.stack)==="@case"&&e==="@case"&&this.decrementIndentLevel(),e==="@case"&&(this.shouldBeIndent=!0),this.stack.push(e);return}if(i.default.includes(H,e)){if(e==="@break"){this.decrementIndentLevel(),this.stack.pop(),this.stack.push(e);return}if(i.default.last(this.stack)!=="@hassection"){this.stack.pop();return}}if(i.default.includes(ae,e)&&(this.shouldBeIndent=!0,this.stack.push(e)),i.default.includes(Q,e)&&i.default.includes(se,i.default.last(this.stack))&&(this.decrementIndentLevel(),this.shouldBeIndent=!0),i.default.includes(P,e)&&(i.default.last(this.stack)==="@section"&&e==="@section"?(this.currentIndentLevel>0&&this.decrementIndentLevel(),this.shouldBeIndent=!0,this.stack.push(e)):(this.shouldBeIndent=!0,this.stack.push(e))),i.default.includes(C,e)){if(e==="@endswitch"&&i.default.last(this.stack)==="@default"){this.decrementIndentLevel(2),this.shouldBeIndent=!1;return}this.decrementIndentLevel(),this.shouldBeIndent=!1,this.stack.pop()}i.default.includes(E,e)&&(this.decrementIndentLevel(),this.shouldBeIndent=!0)}processToken(e,t){if(i.default.includes(e.scopes,"punctuation.definition.comment.begin.blade")&&(this.isInsideCommentBlock=!0),this.argumentCheck){let{count:n,inString:r,stack:s}=this.argumentCheck;if(!r&&t===")"){if(s.push(t),n[t]+=1,n["("]===n[t]){let a=s.join("");pe(a)>=this.argumentCheck.unindentOn&&(this.shouldBeIndent=!1),this.argumentCheck=!1}return}s.push(t),r===t?this.argumentCheck.inString=!1:!r&&(t==='"'||t==="'")&&(this.argumentCheck.inString=t),t==="("&&!r&&(n[t]+=1)}i.default.includes(e.scopes,"punctuation.definition.comment.end.blade")&&(this.isInsideCommentBlock=!1),(t==="{{--"||t.includes("{{--"))&&(this.isInsideCommentBlock=!0),(t==="--}}"||t.includes("--}}"))&&(this.isInsideCommentBlock=!1),!!i.default.includes(e.scopes,"keyword.blade")&&(this.isInsideCommentBlock||(this.processKeyword(t.toLowerCase()),i.default.includes(Object.keys(Z),t.toLowerCase())&&(this.argumentCheck={unindentOn:Z[t.toLowerCase()],stack:[],inString:!1,count:{"(":0,")":0}})))}processTokenizeResult(e,t){if(this.shouldBeIndent&&(this.incrementIndentLevel(),this.shouldBeIndent=!1),le(e,t)){this.insertFormattedLineToResult(t);return}for(let n=0;n<e.tokens.length;n+=1){let r=e.tokens[n],s=t.substring(r.startIndex,r.endIndex).trim();this.processToken(r,s)}this.insertFormattedLineToResult(t)}insertFormattedLineToResult(e){let n=(0,v.default)(e).amount+this.indentSize*this.currentIndentLevel,r=this.indentCharacter.repeat(n<0?0:n)+e.trim();e.length===0&&this.result.push(e),e.length!==0&&r.length>0&&this.result.push(r),r!==e&&this.diffs.push({original:e,formatted:r})}incrementIndentLevel(e=1){this.currentIndentLevel+=e}decrementIndentLevel(e=1){this.currentIndentLevel-=e}formatJS(e){let t=e,n={js:[],entangle:[]};return Object.keys(n).forEach(r=>{t=t.replace(new RegExp(`@${r}\\((?:[^)(]+|\\((?:[^)(]+|\\([^)(]*\\))*\\))*\\)`,"gs"),s=>{let a=n[r].push(s)-1;return this.getPlaceholder(r,a,s.length)})}),t=R.default.js_beautify(t,{brace_style:"preserve-inline"}),Object.keys(n).forEach(r=>{t=t.replace(new RegExp(this.getPlaceholder(r,"_*(\\d+)"),"gms"),(s,a)=>n[r][a])}),t}};var Be=m(require("path")),Ie=m(require("fs")),Re=m(require("ajv")),Ce=m(require("find-config")),Ve=new Re.default,Ee=[".bladeformatterrc.json",".bladeformatterrc"];function De(l){for(let e=0;e<Ee.length;e+=1){let t=(0,Ce.default)(Ee[e],{cwd:Be.default.dirname(l),home:!1});if(t)return t}return null}async function Le(l){if(l===null)return;let e=JSON.parse((await Ie.default.promises.readFile(l)).toString()),t={type:"object",properties:{indentSize:{type:"integer",nullable:!0},wrapLineLength:{type:"integer",nullable:!0},wrapAttributes:{type:"string",enum:["auto","force","force-aligned","force-expand-multiline","aligned-multiple","preserve","preserve-aligned"],nullable:!0},endWithNewline:{type:"boolean",nullable:!0},useTabs:{type:"boolean",nullable:!0}},additionalProperties:!0},n=Ve.compile(t);if(!n(e))throw n;return e}var M=class extends Error{};var V=class{constructor(e={},t=[]){this.currentTargetPath=".",this.paths=t,this.options=e,this.targetFiles=[],this.errors=[],this.diffs=[],this.outputs=[],this.formattedFiles=[],this.ignoreFile="",this.fulFillFiles=[],this.targetFiles=[],this.runtimeConfigCache={}}async format(e,t={}){let n=this.options||t;return await this.readIgnoreFile(g.default.cwd()),await this.readRuntimeConfig(g.default.cwd()),new T(n).formatContent(e).catch(r=>{throw new M(r)})}async formatFromCLI(){try{this.printPreamble(),await this.readIgnoreFile(g.default.cwd()),await this.processPaths(),this.printResults()}catch{}}fileExists(e){return F.default.promises.access(e,F.default.constants.F_OK).then(()=>!0).catch(()=>!1)}async readIgnoreFile(e){let t=".bladeignore",n,r=O.default.dirname(e);if(this.options.ignoreFilePath?n=this.options.ignoreFilePath:n=(0,Te.default)(t,{cwd:r}),!!n)try{this.ignoreFile=(await F.default.promises.readFile(n)).toString()}catch{}}async readRuntimeConfig(e){var n,r;_.default.isEmpty(this.runtimeConfigCache)&&(this.options=_.default.merge(this.options,this.runtimeConfigCache));let t;if(this.options.runtimeConfigPath?t=this.options.runtimeConfigPath:t=De(e),!_.default.isNull(t))try{let s=await Le(t);this.options=_.default.merge(this.options,s),this.runtimeConfigCache=this.options}catch(s){s instanceof SyntaxError&&(g.default.stdout.write($.default.red.bold(`
Blade Formatter JSON Syntax Error: 

`)),g.default.stdout.write(te.default.format(s)),g.default.exit(1)),g.default.stdout.write($.default.red.bold(`
Blade Formatter Config Error: ${O.default.basename(t)}

`)),g.default.stdout.write(`\`${s.errors[0].instancePath.replace("/","")}\` ${s.errors[0].message}

`),((n=s.errors[0].params)==null?void 0:n.allowedValues)&&console.log((r=s.errors[0].params)==null?void 0:r.allowedValues),g.default.exit(1)}}async processPaths(){await Promise.all(_.default.map(this.paths,async e=>this.processPath(e)))}async processPath(e){await V.globFiles(e).then(t=>_.default.map(t,n=>O.default.relative(".",n))).then(t=>this.filterFiles(t)).then(this.fulFillFiles).then(t=>this.formatFiles(t))}static globFiles(e){return new Promise((t,n)=>{(0,Ae.default)(e,(r,s)=>r?n(r):t(s))})}async filterFiles(e){if(this.ignoreFile==="")return e;let t=/^\.\.*/,n=_.default.filter(e,a=>t.test(O.default.relative(".",a))),r=_.default.xor(e,n),s=(0,ke.default)().add(this.ignoreFile).filter(r);return _.default.concat(n,s)}static fulFillFiles(e){return this.targetFiles.push(e),Promise.resolve(e)}async formatFiles(e){await Promise.all(_.default.map(e,async t=>this.formatFile(t)))}async formatFile(e){await this.readRuntimeConfig(e),await K(e).then(t=>Promise.resolve(t.toString("utf-8"))).then(t=>new T(this.options).formatContent(t)).then(t=>this.checkFormatted(e,t)).then(t=>this.writeToFile(e,t)).catch(t=>{this.handleError(e,t)})}async checkFormatted(e,t){this.printFormattedOutput(e,t);let n=F.default.readFileSync(e,"utf-8"),r=z(n),s=z(t),a=ue(e,r,s);return this.diffs.push(a),this.outputs.push(t),a.length>0&&((this.options.progress||this.options.write)&&g.default.stdout.write($.default.green("F")),this.options.checkFormatted&&(g.default.stdout.write(`${e}
`),g.default.exitCode=1),this.formattedFiles.push(e)),a.length===0&&(this.options.progress||this.options.write)&&g.default.stdout.write($.default.green(".")),Promise.resolve(t)}printFormattedOutput(e,t){this.options.write||this.options.checkFormatted||(g.default.stdout.write(`${t}`),_.default.last(this.paths)===e||_.default.last(this.targetFiles)===e)||(this.paths.length>1||this.targetFiles.length>1)&&g.default.stdout.write(`
`)}writeToFile(e,t){!this.options.write||this.options.checkFormatted||t.length===0||_.default.isNull(t)||_.default.isEmpty(t)||F.default.writeFile(e,t,n=>{n&&(g.default.stdout.write(`${$.default.red(n.message)}
`),g.default.exit(1))})}handleError(e,t){(this.options.progress||this.options.write)&&g.default.stdout.write($.default.red("E")),g.default.exitCode=1,this.errors.push({path:e,message:t.message,error:t})}printPreamble(){this.options.checkFormatted&&g.default.stdout.write(`Check formatting... 
`)}async printResults(){this.printDescription(),this.printDifferences(),this.printFormattedFiles(),this.printErrors()}printDescription(){if(!this.options.write)return;let e=`

`;g.default.stdout.write(e),g.default.stdout.write($.default.bold.green(`Fixed: F
`)),g.default.stdout.write($.default.bold.red(`Errors: E
`)),g.default.stdout.write($.default.bold("Not Changed: ")+$.default.bold.green(`.
`))}printFormattedFiles(){if(this.formattedFiles.length===0){this.options.checkFormatted&&g.default.stdout.write($.default.bold(`
All matched files are formatted! 
`));return}if(!this.options.write){this.options.checkFormatted&&g.default.stdout.write(`
Above file(s) are formattable. Forgot to run formatter? Use ${$.default.bold("--write")} option to overwrite.
`);return}g.default.stdout.write($.default.bold(`
Formatted Files: 
`)),_.default.each(this.formattedFiles,e=>g.default.stdout.write(`${$.default.bold(e)}
`))}printDifferences(){if(!!this.options.diff){if(g.default.stdout.write($.default.bold(`
Differences: 

`)),_.default.filter(this.diffs,e=>e.length>0).length===0){g.default.stdout.write((0,$.default)(`No changes found. 

`));return}_.default.each(this.diffs,e=>de(e))}}printErrors(){_.default.isEmpty(this.errors)||(g.default.stdout.write($.default.red.bold(`
Errors: 

`)),_.default.each(this.errors,e=>g.default.stdout.write(`${te.default.format(e)}
`)))}};module.exports=Ne(Ge);0&&(module.exports={BladeFormatter,Formatter});
//# sourceMappingURL=bundle.js.map
